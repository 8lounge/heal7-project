# ğŸ”— HEAL7 ê³µìœ  ë°ì´í„°íë¸Œ ì„¤ì •
# ëª¨ë“  ì„œë¹„ìŠ¤ê°€ ê³µìœ í•˜ëŠ” í•µì‹¬ ë°ì´í„° ë° ì¸ì¦ ì‹œìŠ¤í…œ

cube_info:
  name: "shared-data-cube"
  version: "2.0.0"
  description: "ì‚¬ìš©ì ê´€ë¦¬, ì¸ì¦, ì„¸ì…˜, ì „ì—­ ì„¤ì • ë“± ê³µí†µ ë°ì´í„° ê´€ë¦¬"
  maintainer: "HEAL7 í”Œë«í¼íŒ€"
  created_at: "2024-03-15"
  category: "infrastructure"
  criticality: "high"  # ëª¨ë“  ì„œë¹„ìŠ¤ì˜ í•µì‹¬ ì˜ì¡´ì„±

# ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
database:
  postgresql:
    schema_name: "shared_common"
    description: "ì‚¬ìš©ì, ì„¸ì…˜, ì „ì—­ ì„¤ì • ë“± ê³µí†µ í…Œì´ë¸”"
    tables:
      - "users"                    # ì‚¬ìš©ì ê¸°ë³¸ ì •ë³´
      - "user_sessions"            # ì‚¬ìš©ì ì„¸ì…˜
      - "global_settings"          # ì „ì—­ ì‹œìŠ¤í…œ ì„¤ì •  
      - "user_preferences"         # ì‚¬ìš©ì ê°œì¸ì„¤ì •
      - "audit_logs"              # ê°ì‚¬ ë¡œê·¸
    pool_size: 30  # ë§ì€ ì—°ê²° í•„ìš”
    max_overflow: 50
    connection_lifetime: 3600
    
  redis:
    db_number: 0  # ê¸°ë³¸ DB (ê°€ì¥ ì¤‘ìš”)
    namespace: "shared_common"
    description: "ì‚¬ìš©ì ì„¸ì…˜, JWT í† í°, ì „ì—­ ìºì‹œ"
    key_patterns:
      - "shared_common:user_session:{user_id}"
      - "shared_common:jwt_token:{jti}"
      - "shared_common:global_config"
      - "shared_common:user_cache:{user_id}"
    connection_pool: 25
    default_ttl: 86400  # 1 day
    persistent_keys: true  # ì¼ë¶€ í‚¤ëŠ” ì˜êµ¬ ì €ì¥
    
  jsonb:
    enabled: false
    reason: "ê³µí†µ ë°ì´í„°ëŠ” ì •ê·œí™”ëœ êµ¬ì¡° í•„ìš”"

# API ì¸í„°í˜ì´ìŠ¤ ì„¤ì •
interfaces:
  rest_api:
    enabled: true
    port: 8000  # ê¸°ë³¸ í¬íŠ¸
    prefix: "/api/v1/shared"
    endpoints:
      - "/users"                   # ì‚¬ìš©ì ê´€ë¦¬
      - "/auth"                   # ì¸ì¦ (ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ)
      - "/sessions"               # ì„¸ì…˜ ê´€ë¦¬
      - "/global-config"          # ì „ì—­ ì„¤ì •
      - "/health"                 # í—¬ìŠ¤ì²´í¬
    
  message_queue:
    enabled: true
    topics:
      subscribe:
        - "system.maintenance.start"  # ì‹œìŠ¤í…œ ì ê²€ ì‹œì‘
        - "system.maintenance.end"    # ì‹œìŠ¤í…œ ì ê²€ ì¢…ë£Œ
      publish:
        - "user.created"             # ìƒˆ ì‚¬ìš©ì ìƒì„±
        - "user.updated"             # ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸
        - "user.deleted"             # ì‚¬ìš©ì ì‚­ì œ
        - "session.created"          # ì„¸ì…˜ ìƒì„±
        - "session.expired"          # ì„¸ì…˜ ë§Œë£Œ
        - "config.updated"           # ì„¤ì • ë³€ê²½
    
  internal_api:
    enabled: true
    description: "ë‹¤ë¥¸ íë¸Œë“¤ì´ ì§ì ‘ í˜¸ì¶œí•˜ëŠ” ë‚´ë¶€ API"
    authentication: "service_token"

# ì‚¬ìš©ì ê´€ë¦¬ ì„¤ì •
user_management:
  registration:
    enabled: true
    email_verification_required: true
    default_role: "user"
    
  authentication:
    methods: ["email_password", "oauth"]
    password_policy:
      min_length: 8
      require_special_chars: true
      require_numbers: true
      require_uppercase: true
    
    jwt_settings:
      access_token_expiry: 3600    # 1 hour
      refresh_token_expiry: 604800  # 7 days
      algorithm: "HS256"
      
  session_management:
    max_concurrent_sessions: 5
    session_timeout: 86400        # 24 hours
    remember_me_duration: 2592000  # 30 days

# ê¶Œí•œ ë° ë³´ì•ˆ ì„¤ì •
security:
  encryption_enabled: true
  password_hashing: "bcrypt"
  rounds: 12
  
  access_control: "rbac"  # Role-Based Access Control
  default_roles:
    - name: "user"
      permissions: ["read_own_data", "update_own_profile"]
    - name: "premium_user"  
      permissions: ["read_own_data", "update_own_profile", "access_premium_features"]
    - name: "admin"
      permissions: ["read_all_data", "manage_users", "manage_system"]
    - name: "service"
      permissions: ["read_user_data", "create_sessions"]
  
  audit_logging:
    enabled: true
    log_all_access: true
    sensitive_operations: ["login", "password_change", "permission_grant"]
    retention_days: 365
  
  rate_limiting:
    login_attempts: "5/hour"
    password_reset: "3/hour"
    api_calls: "1000/hour"

# ì™¸ë¶€ ì˜ì¡´ì„± (ìµœì†Œí™”)
dependencies:
  cubes: []  # ë‹¤ë¥¸ íë¸Œì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ (ê¸°ë°˜ íë¸Œ)
  
  external_services:
    - name: "Email Service"
      description: "íšŒì›ê°€ì… í™•ì¸ ì´ë©”ì¼ ë°œì†¡"
      required: true
      fallback: "local_smtp"
    - name: "OAuth Providers"
      description: "ì†Œì…œ ë¡œê·¸ì¸ (Google, Kakao ë“±)"
      required: false

# ëª¨ë‹ˆí„°ë§ ì„¤ì • (ë§¤ìš° ì¤‘ìš”)
monitoring:
  metrics_enabled: true
  health_check_interval: 15  # ìì£¼ ì²´í¬
  performance_logging: true
  
  critical_metrics:
    - "active_user_sessions"
    - "authentication_success_rate"
    - "database_connection_pool_usage"
    - "redis_memory_usage"
    - "api_response_time"
  
  alerts:
    authentication_failure_rate: 0.1      # 10% ì‹¤íŒ¨ìœ¨
    database_connection_threshold: 0.9     # 90% ì‚¬ìš©ëŸ‰
    redis_memory_threshold: 0.8           # 80% ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
    session_creation_anomaly: "2x_normal" # í‰ì†Œì˜ 2ë°°
    
  dashboards:
    - "ì‚¬ìš©ì í™œë™ ëŒ€ì‹œë³´ë“œ"
    - "ì¸ì¦ ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§"
    - "ì„¸ì…˜ ê´€ë¦¬ í˜„í™©"

# ë°±ì—… ë° ê³ ê°€ìš©ì„±
backup:
  auto_backup: true
  backup_interval: "every_6_hours"  # ë” ìì£¼ ë°±ì—…
  backup_time: ["02:00", "08:00", "14:00", "20:00"]
  retention_days: 90
  
  backup_targets:
    postgresql: true
    redis: true  # ì„¸ì…˜ ë°ì´í„°ë„ ì¤‘ìš”
    
  disaster_recovery:
    enabled: true
    replication: "master_slave"
    failover_automatic: true
    recovery_time_objective: 300  # 5ë¶„ ì´ë‚´ ë³µêµ¬

# ì„±ëŠ¥ ìµœì í™” (ê³ ì„±ëŠ¥ í•„ìš”)
performance:
  connection_pooling: true
  query_optimization: true
  
  caching_strategies:
    - "user_profile_cache"      # ì‚¬ìš©ì í”„ë¡œí•„ ìºì‹œ
    - "permission_cache"        # ê¶Œí•œ ì •ë³´ ìºì‹œ
    - "global_config_cache"     # ì „ì—­ ì„¤ì • ìºì‹œ
    - "session_cache"          # ì„¸ì…˜ ì •ë³´ ìºì‹œ
  
  database_optimization:
    index_maintenance: "auto"
    query_plan_analysis: true
    slow_query_logging: true
    
  redis_optimization:
    memory_optimization: true
    persistence: "rdb_aof"  # ë°ì´í„° ì•ˆì •ì„±
    maxmemory_policy: "allkeys-lru"
    
  scaling:
    horizontal_scaling: true
    load_balancing: true
    auto_scaling: true
    max_instances: 10

# ë°ì´í„° í’ˆì§ˆ ë° ì •í•©ì„±
data_quality:
  validation_enabled: true
  strict_validation: true
  
  validation_rules:
    - "email_format_validation"
    - "password_strength_validation"
    - "user_data_consistency_check"
    - "session_integrity_validation"
  
  cleanup_policies:
    - name: "expired_sessions_cleanup"
      schedule: "hourly"
      action: "delete_expired_sessions"
    - name: "inactive_users_warning"
      schedule: "monthly"
      action: "notify_inactive_users"
    - name: "audit_log_archiving"
      schedule: "monthly"
      action: "archive_old_audit_logs"

# ê¸€ë¡œë²Œ ì„¤ì • ê´€ë¦¬
global_configuration:
  dynamic_config: true
  config_hot_reload: true
  
  default_settings:
    system:
      maintenance_mode: false
      max_file_upload_size: "50MB"
      session_timeout: 86400
      api_rate_limit: 1000
      
    features:
      user_registration_enabled: true
      social_login_enabled: true
      email_notifications_enabled: true
      premium_features_enabled: true
      
    security:
      password_reset_enabled: true
      two_factor_auth_enabled: false
      ip_whitelist_enabled: false

# ê°œë°œ í™˜ê²½
development:
  debug_mode: false  # ë³´ì•ˆìƒ false
  test_users_enabled: true
  mock_email_service: true
  
  test_configurations:
    load_testing: true
    security_testing: true
    integration_testing: true

# ìš´ì˜ í™˜ê²½ (ìµœê³  ìˆ˜ì¤€ ë³´ì•ˆ)
production:
  high_availability: true
  load_balancing: true
  ssl_required: true
  
  security_hardening:
    password_complexity_max: true
    session_security_max: true
    audit_logging_detailed: true
    
  maintenance_windows:
    - day: "Sunday"
      time: "04:00-05:00" 
      description: "ê³µìœ  ë°ì´í„° ì •ê¸° ì ê²€ (ë‹¤ë¥¸ ì„œë¹„ìŠ¤ ì ê²€ í›„)"
      
# ê·œì • ì¤€ìˆ˜
compliance:
  gdpr: true
  ccpa: true  
  korean_privacy_law: true
  
  data_retention:
    user_data: "5_years"
    session_data: "1_year"  
    audit_logs: "7_years"
    
  data_export:
    user_data_export: true
    format: ["json", "csv"]
    encryption: true