# ğŸ•·ï¸ HEAL7 í¬ë¡¤ë§ ë°ì´í„°íë¸Œ ì„¤ì •
# ì›¹ ìŠ¤í¬ë˜í•‘ ë° ë°ì´í„° ìˆ˜ì§‘ì˜ ì™„ì „í•œ ë¼ì´í”„ì‚¬ì´í´ ê´€ë¦¬

cube_info:
  name: "crawling-data-cube"
  version: "2.0.0"
  description: "ì •ë¶€í¬í„¸, ê¿ˆí’€ì´, ì¼ë°˜ ì›¹ì‚¬ì´íŠ¸ ë°ì´í„° ìˆ˜ì§‘ ë° ì²˜ë¦¬ íë¸Œ"
  maintainer: "HEAL7 í¬ë¡¤ë§íŒ€"
  created_at: "2024-03-15"
  category: "data_collection"

# ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • (JSONB ì¤‘ì‹¬)
database:
  postgresql:
    schema_name: "crawling_service"
    description: "ìŠ¤í¬ë˜í•‘ ì„¸ì…˜ ê´€ë¦¬ ë° ë©”íƒ€ë°ì´í„°"
    tables:
      - "scraping_sessions"        # ìŠ¤í¬ë˜í•‘ ì„¸ì…˜ ê´€ë¦¬
      - "data_sources"            # ë°ì´í„° ì†ŒìŠ¤ ì •ë³´
      - "quality_metrics"         # ë°ì´í„° í’ˆì§ˆ ì§€í‘œ
    pool_size: 10
    max_overflow: 20
    
  redis:
    db_number: 2
    namespace: "crawling_service"
    description: "í¬ë¡¤ë§ í, ì†ë„ ì œí•œ, ì„ì‹œ ì €ì¥ì†Œ"
    key_patterns:
      - "crawling_service:queue:{domain}"
      - "crawling_service:rate_limit:{domain}"
      - "crawling_service:session:{session_id}"
      - "crawling_service:duplicate_check:*"
    connection_pool: 20
    default_ttl: 86400  # 1 day
    
  jsonb:
    enabled: true
    primary_use: true
    description: "ìŠ¤í¬ë˜í•‘ëœ ì›ë³¸ ë°ì´í„°ì˜ ìœ ì—°í•œ ì €ì¥"
    tables:
      - "government_portal_raw_data"    # ì •ë¶€í¬í„¸ ì›ë³¸ ë°ì´í„°
      - "dream_interpretation_raw_data" # ê¿ˆí’€ì´ ì›ë³¸ ë°ì´í„°
      - "general_web_scraping_data"     # ì¼ë°˜ ì›¹ ë°ì´í„°
    optimization: "gin_indexes"

# API ì¸í„°í˜ì´ìŠ¤ ì„¤ì •
interfaces:
  rest_api:
    enabled: true
    port: 8003
    prefix: "/api/v1/crawling"
    endpoints:
      - "/scraping-sessions"       # ìŠ¤í¬ë˜í•‘ ì„¸ì…˜ ê´€ë¦¬
      - "/collected-data"         # ìˆ˜ì§‘ëœ ë°ì´í„° ì¡°íšŒ
      - "/quality-reports"        # í’ˆì§ˆ ë³´ê³ ì„œ
      - "/data-export"           # ë°ì´í„° ë‚´ë³´ë‚´ê¸°
    
  message_queue:
    enabled: true
    topics:
      subscribe:
        - "crawling.request.new"     # ìƒˆ í¬ë¡¤ë§ ìš”ì²­
        - "crawling.schedule.trigger" # ìŠ¤ì¼€ì¤„ íŠ¸ë¦¬ê±°
      publish:
        - "crawling.data.collected"   # ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ
        - "crawling.session.completed" # ì„¸ì…˜ ì™„ë£Œ
        - "crawling.error.critical"   # ì‹¬ê°í•œ ì˜¤ë¥˜ ë°œìƒ
    
  scheduler:
    enabled: true
    engine: "celery"
    description: "ì£¼ê¸°ì  í¬ë¡¤ë§ ì‘ì—… ìŠ¤ì¼€ì¤„ë§"

# ë°ì´í„° ìˆ˜ì§‘ ì„¤ì •
data_collection:
  targets:
    government_portals:
      - name: "bizinfo"
        url: "https://www.bizinfo.go.kr"
        schedule: "daily"
        priority: "high"
      - name: "k-startup"
        url: "https://www.k-startup.go.kr"
        schedule: "daily"
        priority: "high"
    
    dream_sites:
      - name: "sajuforum"
        url: "https://www.sajuforum.com"
        schedule: "weekly"
        priority: "medium"
      - name: "unse2u"
        url: "https://www.unse2u.co.kr"  
        schedule: "weekly"
        priority: "medium"
  
  crawler_settings:
    user_agent: "HEAL7-Crawler/2.0 (+https://heal7.com/crawler)"
    delay_range: [2, 5]  # seconds
    max_retries: 3
    timeout: 30
    respect_robots_txt: true
    
  rate_limiting:
    global_rate: "100/minute"
    per_domain_rate: "10/minute"
    burst_allowance: 5

# ë°ì´í„° ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸
processing:
  data_validation:
    enabled: true
    rules:
      - "content_length_check"      # ìµœì†Œ ì½˜í…ì¸  ê¸¸ì´
      - "duplicate_detection"       # ì¤‘ë³µ ì½˜í…ì¸  íƒì§€
      - "quality_scoring"          # AI í’ˆì§ˆ ì ìˆ˜
      - "malicious_content_filter" # ì•…ì„± ì½˜í…ì¸  í•„í„°
  
  data_cleaning:
    enabled: true
    operations:
      - "html_tag_removal"         # HTML íƒœê·¸ ì œê±°
      - "special_character_normalize" # íŠ¹ìˆ˜ë¬¸ì ì •ê·œí™”
      - "encoding_standardization"  # ì¸ì½”ë”© í†µì¼
      - "whitespace_cleanup"       # ê³µë°± ì •ë¦¬
  
  ai_analysis:
    enabled: true
    models:
      - name: "content_classifier"
        purpose: "ì½˜í…ì¸  ë¶„ë¥˜"
      - name: "quality_assessor"
        purpose: "í’ˆì§ˆ í‰ê°€"
      - name: "duplicate_detector"
        purpose: "ì¤‘ë³µ íƒì§€"

# ì™¸ë¶€ ì˜ì¡´ì„±
dependencies:
  cubes:
    - name: "shared-data-cube"
      reason: "ì‚¬ìš©ì ì¸ì¦ ë° ì„¸ì…˜ ê´€ë¦¬"
      endpoints: ["/auth", "/sessions"]
    - name: "ai-monitoring-data-cube"  
      reason: "AI ëª¨ë¸ ì‚¬ìš©ëŸ‰ ì¶”ì "
      endpoints: ["/model-usage"]
  
  external_services:
    - name: "Proxy Services"
      description: "IP ì°¨ë‹¨ ë°©ì§€ìš© í”„ë¡ì‹œ"
      required: false
    - name: "Content APIs"
      description: "ì¶”ê°€ì ì¸ ë°ì´í„° ì†ŒìŠ¤ API"
      required: false

# ëª¨ë‹ˆí„°ë§ ì„¤ì •
monitoring:
  metrics_enabled: true
  health_check_interval: 60
  performance_logging: true
  
  key_metrics:
    - "pages_crawled_per_hour"
    - "data_quality_score_average"
    - "duplicate_detection_rate"
    - "crawler_success_rate"
    - "storage_usage_growth"
  
  alerts:
    crawler_failure_threshold: 3      # ì—°ì† ì‹¤íŒ¨ íšŸìˆ˜
    storage_usage_threshold: 0.8      # 80% ì‚¬ìš©ëŸ‰
    quality_score_threshold: 6.0      # í’ˆì§ˆ ì ìˆ˜ í•˜í•œì„ 
    duplicate_rate_threshold: 0.3     # 30% ì¤‘ë³µë¥ 

# ë³´ì•ˆ ì„¤ì •
security:
  encryption_enabled: true
  
  access_control: "service_based"
  allowed_services: ["dashboard_service", "saju_service"]
  
  data_privacy:
    anonymization: true
    personal_data_detection: true
    gdpr_compliance: true
  
  crawler_ethics:
    respect_robots_txt: true
    rate_limiting_strict: true
    no_aggressive_crawling: true
    copyright_awareness: true

# ë°±ì—… ë° ë³´ì¡´
backup:
  auto_backup: true
  backup_interval: "daily"
  backup_time: "01:00"
  retention_days: 90  # ë” ê¸´ ë³´ì¡´ê¸°ê°„ (ë°ì´í„° ê°€ì¹˜)
  
  backup_targets:
    postgresql: true
    jsonb_data: true
    redis: false  # ì„ì‹œ ë°ì´í„°ëŠ” ë°±ì—… ì•ˆí•¨
  
  archive_policy:
    old_data_archive: true
    archive_after_days: 365
    compressed_storage: true

# ì„±ëŠ¥ ìµœì í™”  
performance:
  parallel_crawling: true
  max_concurrent_crawlers: 10
  
  storage_optimization:
    compression: "gzip"
    indexing: "gin_jsonb"
    partitioning: "by_month"
  
  cache_strategies:
    - "frequently_accessed_data"
    - "recent_crawling_results"
    - "quality_analysis_cache"
  
  scaling:
    horizontal_scaling: true
    auto_scaling_trigger: "queue_size > 1000"
    max_instances: 5

# ë°ì´í„° í’ˆì§ˆ ê´€ë¦¬
data_quality:
  validation_pipeline: true
  
  quality_rules:
    - name: "minimum_content_length"
      threshold: 50
    - name: "content_language_detection"
      expected: "korean"
    - name: "data_freshness_check" 
      max_age_days: 30
    - name: "source_reliability_score"
      min_score: 7.0
  
  cleanup_policies:
    - name: "low_quality_data_removal"
      schedule: "weekly"  
      criteria: "quality_score < 5.0"
    - name: "duplicate_data_deduplication"
      schedule: "daily"
      method: "content_hash_comparison"
    - name: "expired_session_cleanup"
      schedule: "daily"
      age_threshold: "7 days"

# ê°œë°œ í™˜ê²½
development:
  debug_mode: true
  test_crawling_enabled: true
  mock_external_sites: true
  
  test_data:
    sample_sites: ["httpbin.org", "example.com"]
    mock_responses: true
    
# ìš´ì˜ í™˜ê²½
production:
  distributed_crawling: true
  fault_tolerance: true
  automatic_recovery: true
  
  maintenance_windows:
    - day: "Sunday"  
      time: "02:00-03:00"
      description: "í¬ë¡¤ëŸ¬ ì •ê¸° ì ê²€ ë° ìºì‹œ ì •ë¦¬"