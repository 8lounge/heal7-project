"""
ğŸŒŸ ì‚¬ì£¼ ì‹œìŠ¤í…œ ì „ì—­ ìƒìˆ˜ (GLOBAL CONSTANTS)
==============================================

ì´ íŒŒì¼ì€ ëª¨ë“  ì‚¬ì£¼ ê³„ì‚°ì˜ ìƒìˆ˜ ì •ì˜ë¥¼ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.
ë‹¤ë¥¸ ê³³ì—ì„œ ìƒìˆ˜ë¥¼ ì¤‘ë³µ ì •ì˜í•˜ì§€ ë§ˆì„¸ìš”!

ğŸ“ ì¤‘ìš” ì›ì¹™:
- ì´ íŒŒì¼ì˜ ìƒìˆ˜ë“¤ì€ ì ˆëŒ€ ë³€ê²½í•˜ë©´ ì•ˆ ë©ë‹ˆë‹¤
- íŠ¹íˆ REFERENCE_DATEì™€ REFERENCE_GAPJA_INDEXëŠ” ì‹œìŠ¤í…œ ì „ì²´ì˜ ê¸°ì¤€ì 
- ìƒˆë¡œìš´ ìƒìˆ˜ ì¶”ê°€ëŠ” ê°€ëŠ¥í•˜ì§€ë§Œ ê¸°ì¡´ ìƒìˆ˜ ìˆ˜ì •ì€ ê¸ˆì§€

ğŸ“ ì‚¬ìš©ë²•:
from core.saju_constants import GAPJA_60, REFERENCE_DATE
gapja = GAPJA_60[index]
"""

from datetime import date
import os

# ==========================================
# ğŸ“ í•µì‹¬ ê¸°ì¤€ì  (ì ˆëŒ€ ë³€ê²½ ê¸ˆì§€!)
# ==========================================

# 60ê°‘ì ê³„ì‚°ì˜ ì ˆëŒ€ ê¸°ì¤€ì 
REFERENCE_DATE = date(1900, 1, 31)  # 1900ë…„ 1ì›” 31ì¼ = ê°‘ì§„ì¼
REFERENCE_GAPJA_INDEX = 40           # ê°‘ì§„ì˜ ì¸ë±ìŠ¤ (0-based)

# KASI API ì„¤ì •
KASI_API_KEY = os.getenv('KASI_API_KEY', 'AR2zMFQPIPBFak%2BMdXzznzVmtsICp7dwd3eo9XCUP62kXpr4GrX3eqi28erzZhXfIemuo6C5AK58eLMKBw8VGQ%3D%3D')
KASI_BASE_URL = "http://apis.data.go.kr/B090041/openapi/service/LrsrCldInfoService"

# ==========================================
# ğŸ“ 60ê°‘ì ìˆœí™˜í‘œ (ì¸ë±ìŠ¤ ìˆœì„œ ì¤‘ìš”)
# ==========================================

GAPJA_60 = [
    "ê°‘ì", "ì„ì¶•", "ë³‘ì¸", "ì •ë¬˜", "ë¬´ì§„", "ê¸°ì‚¬", "ê²½ì˜¤", "ì‹ ë¯¸", "ì„ì‹ ", "ê³„ìœ ",  # 0-9
    "ê°‘ìˆ ", "ì„í•´", "ë³‘ì", "ì •ì¶•", "ë¬´ì¸", "ê¸°ë¬˜", "ê²½ì§„", "ì‹ ì‚¬", "ì„ì˜¤", "ê³„ë¯¸",  # 10-19
    "ê°‘ì‹ ", "ì„ìœ ", "ë³‘ìˆ ", "ì •í•´", "ë¬´ì", "ê¸°ì¶•", "ê²½ì¸", "ì‹ ë¬˜", "ì„ì§„", "ê³„ì‚¬",  # 20-29
    "ê°‘ì˜¤", "ì„ë¯¸", "ë³‘ì‹ ", "ì •ìœ ", "ë¬´ìˆ ", "ê¸°í•´", "ê²½ì", "ì‹ ì¶•", "ì„ì¸", "ê³„ë¬˜",  # 30-39
    "ê°‘ì§„", "ì„ì‚¬", "ë³‘ì˜¤", "ì •ë¯¸", "ë¬´ì‹ ", "ê¸°ìœ ", "ê²½ìˆ ", "ì‹ í•´", "ì„ì", "ê³„ì¶•",  # 40-49 (ê°‘ì§„=40)
    "ê°‘ì¸", "ì„ë¬˜", "ë³‘ì§„", "ì •ì‚¬", "ë¬´ì˜¤", "ê¸°ë¯¸", "ê²½ì‹ ", "ì‹ ìœ ", "ì„ìˆ ", "ê³„í•´"   # 50-59
]

# ==========================================
# ğŸ“ ì²œê°„ (10ê°œ)
# ==========================================

CHEONGAN_10 = ["ê°‘", "ì„", "ë³‘", "ì •", "ë¬´", "ê¸°", "ê²½", "ì‹ ", "ì„", "ê³„"]

CHEONGAN_PROPERTIES = {
    "ê°‘": {"element": "ëª©", "yin_yang": "ì–‘", "chinese": "ç”²"},
    "ì„": {"element": "ëª©", "yin_yang": "ìŒ", "chinese": "ä¹™"},
    "ë³‘": {"element": "í™”", "yin_yang": "ì–‘", "chinese": "ä¸™"},
    "ì •": {"element": "í™”", "yin_yang": "ìŒ", "chinese": "ä¸"},
    "ë¬´": {"element": "í† ", "yin_yang": "ì–‘", "chinese": "æˆŠ"},
    "ê¸°": {"element": "í† ", "yin_yang": "ìŒ", "chinese": "å·±"},
    "ê²½": {"element": "ê¸ˆ", "yin_yang": "ì–‘", "chinese": "åºš"},
    "ì‹ ": {"element": "ê¸ˆ", "yin_yang": "ìŒ", "chinese": "è¾›"},
    "ì„": {"element": "ìˆ˜", "yin_yang": "ì–‘", "chinese": "å£¬"},
    "ê³„": {"element": "ìˆ˜", "yin_yang": "ìŒ", "chinese": "ç™¸"}
}

# ==========================================
# ğŸ“ ì§€ì§€ (12ê°œ)
# ==========================================

JIJI_12 = ["ì", "ì¶•", "ì¸", "ë¬˜", "ì§„", "ì‚¬", "ì˜¤", "ë¯¸", "ì‹ ", "ìœ ", "ìˆ ", "í•´"]

JIJI_PROPERTIES = {
    "ì": {"zodiac": "ì¥",      "element": "ìˆ˜", "season": "ê²¨ìš¸", "chinese": "å­"},
    "ì¶•": {"zodiac": "ì†Œ",      "element": "í† ", "season": "ê²¨ìš¸", "chinese": "ä¸‘"},
    "ì¸": {"zodiac": "í˜¸ë‘ì´",  "element": "ëª©", "season": "ë´„",   "chinese": "å¯…"},
    "ë¬˜": {"zodiac": "í† ë¼",    "element": "ëª©", "season": "ë´„",   "chinese": "å¯"},
    "ì§„": {"zodiac": "ìš©",      "element": "í† ", "season": "ë´„",   "chinese": "è¾°"},
    "ì‚¬": {"zodiac": "ë±€",      "element": "í™”", "season": "ì—¬ë¦„", "chinese": "å·³"},
    "ì˜¤": {"zodiac": "ë§",      "element": "í™”", "season": "ì—¬ë¦„", "chinese": "åˆ"},
    "ë¯¸": {"zodiac": "ì–‘",      "element": "í† ", "season": "ì—¬ë¦„", "chinese": "æœª"},
    "ì‹ ": {"zodiac": "ì›ìˆ­ì´",  "element": "ê¸ˆ", "season": "ê°€ì„", "chinese": "ç”³"},
    "ìœ ": {"zodiac": "ë‹­",      "element": "ê¸ˆ", "season": "ê°€ì„", "chinese": "é…‰"},
    "ìˆ ": {"zodiac": "ê°œ",      "element": "í† ", "season": "ê°€ì„", "chinese": "æˆŒ"},
    "í•´": {"zodiac": "ë¼ì§€",    "element": "ìˆ˜", "season": "ê²¨ìš¸", "chinese": "äº¥"}
}

# ==========================================
# ğŸ“ 24ì ˆê¸° ì •ë³´
# ==========================================

SOLAR_TERMS_24 = [
    "ì…ì¶˜", "ìš°ìˆ˜", "ê²½ì¹©", "ì¶˜ë¶„", "ì²­ëª…", "ê³¡ìš°",      # ë´„ (1-6)
    "ì…í•˜", "ì†Œë§Œ", "ë§ì¢…", "í•˜ì§€", "ì†Œì„œ", "ëŒ€ì„œ",      # ì—¬ë¦„ (7-12)
    "ì…ì¶”", "ì²˜ì„œ", "ë°±ë¡œ", "ì¶”ë¶„", "í•œë¡œ", "ìƒê°•",      # ê°€ì„ (13-18)
    "ì…ë™", "ì†Œì„¤", "ëŒ€ì„¤", "ë™ì§€", "ì†Œí•œ", "ëŒ€í•œ"       # ê²¨ìš¸ (19-24)
]

SOLAR_TERMS_CHINESE = {
    "ì…ì¶˜": "ç«‹æ˜¥", "ìš°ìˆ˜": "é›¨æ°´", "ê²½ì¹©": "é©šèŸ„", "ì¶˜ë¶„": "æ˜¥åˆ†", "ì²­ëª…": "æ·¸æ˜", "ê³¡ìš°": "ç©€é›¨",
    "ì…í•˜": "ç«‹å¤", "ì†Œë§Œ": "å°æ»¿", "ë§ì¢…": "èŠ’ç¨®", "í•˜ì§€": "å¤è‡³", "ì†Œì„œ": "å°æš‘", "ëŒ€ì„œ": "å¤§æš‘",
    "ì…ì¶”": "ç«‹ç§‹", "ì²˜ì„œ": "è™•æš‘", "ë°±ë¡œ": "ç™½éœ²", "ì¶”ë¶„": "ç§‹åˆ†", "í•œë¡œ": "å¯’éœ²", "ìƒê°•": "éœœé™",
    "ì…ë™": "ç«‹å†¬", "ì†Œì„¤": "å°é›ª", "ëŒ€ì„¤": "å¤§é›ª", "ë™ì§€": "å†¬è‡³", "ì†Œí•œ": "å°å¯’", "ëŒ€í•œ": "å¤§å¯’"
}

# ==========================================
# ğŸ“ ì˜¤í–‰ (äº”è¡Œ) ê´€ê³„
# ==========================================

WUXING_5 = ["ëª©", "í™”", "í† ", "ê¸ˆ", "ìˆ˜"]

WUXING_RELATIONS = {
    "ìƒìƒ": {  # ì„œë¡œ ìƒì„±í•˜ëŠ” ê´€ê³„
        "ëª©": "í™”",  # ëª©ìƒí™”
        "í™”": "í† ",  # í™”ìƒí† 
        "í† ": "ê¸ˆ",  # í† ìƒê¸ˆ
        "ê¸ˆ": "ìˆ˜",  # ê¸ˆìƒìˆ˜
        "ìˆ˜": "ëª©"   # ìˆ˜ìƒëª©
    },
    "ìƒê·¹": {  # ì„œë¡œ ê·¹í•˜ëŠ” ê´€ê³„
        "ëª©": "í† ",  # ëª©ê·¹í† 
        "í™”": "ê¸ˆ",  # í™”ê·¹ê¸ˆ
        "í† ": "ìˆ˜",  # í† ê·¹ìˆ˜
        "ê¸ˆ": "ëª©",  # ê¸ˆê·¹ëª©
        "ìˆ˜": "í™”"   # ìˆ˜ê·¹í™”
    }
}

# ==========================================
# ğŸ“ ì‹œê°„ ê´€ë ¨ ìƒìˆ˜
# ==========================================

# ì‹œê°„ëŒ€ë³„ ì§€ì§€ ë§¤í•‘ (24ì‹œê°„ â†’ 12ì§€ì§€)
HOUR_TO_JIJI = {
    23: "ì", 0: "ì", 1: "ì",      # ìì‹œ (23-01)
    2: "ì¶•", 3: "ì¶•",                # ì¶•ì‹œ (01-03)
    4: "ì¸", 5: "ì¸",                # ì¸ì‹œ (03-05)
    6: "ë¬˜", 7: "ë¬˜",                # ë¬˜ì‹œ (05-07)
    8: "ì§„", 9: "ì§„",                # ì§„ì‹œ (07-09)
    10: "ì‚¬", 11: "ì‚¬",              # ì‚¬ì‹œ (09-11)
    12: "ì˜¤", 13: "ì˜¤",              # ì˜¤ì‹œ (11-13)
    14: "ë¯¸", 15: "ë¯¸",              # ë¯¸ì‹œ (13-15)
    16: "ì‹ ", 17: "ì‹ ",              # ì‹ ì‹œ (15-17)
    18: "ìœ ", 19: "ìœ ",              # ìœ ì‹œ (17-19)
    20: "ìˆ ", 21: "ìˆ ",              # ìˆ ì‹œ (19-21)
    22: "í•´"                         # í•´ì‹œ (21-23)
}

# ==========================================
# ğŸ“ API ì‘ë‹µ ë° ì„¤ì •
# ==========================================

# API ì‘ë‹µ í…œí”Œë¦¿
API_SUCCESS_TEMPLATE = {
    "success": True,
    "data": None,
    "source": "unified_saju_core",
    "version": "2.0.0"
}

API_ERROR_TEMPLATE = {
    "success": False,
    "error": None,
    "source": "unified_saju_core",
    "version": "2.0.0"
}

# ì‹œìŠ¤í…œ ì„¤ì •
SYSTEM_CONFIG = {
    "cache_enabled": True,
    "cache_max_size": 1000,
    "api_timeout": 10,
    "fallback_enabled": True,
    "debug_mode": False
}

# ==========================================
# ğŸ“ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
# ==========================================

def get_gapja_info(gapja: str) -> dict:
    """
    ê°‘ì ì •ë³´ ë°˜í™˜
    
    Args:
        gapja: ê°‘ì ë¬¸ìì—´ (ì˜ˆ: "ê°‘ì")
        
    Returns:
        dict: ê°‘ì ìƒì„¸ ì •ë³´
    """
    if gapja not in GAPJA_60:
        return {"error": "Invalid gapja"}
    
    index = GAPJA_60.index(gapja)
    cheongan = gapja[0]
    jiji = gapja[1]
    
    return {
        "gapja": gapja,
        "index": index,
        "cheongan": cheongan,
        "jiji": jiji,
        "cheongan_info": CHEONGAN_PROPERTIES.get(cheongan, {}),
        "jiji_info": JIJI_PROPERTIES.get(jiji, {})
    }

def get_element_relation(element1: str, element2: str) -> str:
    """
    ë‘ ì˜¤í–‰ ê°„ì˜ ê´€ê³„ ë°˜í™˜
    
    Args:
        element1, element2: ì˜¤í–‰ ("ëª©", "í™”", "í† ", "ê¸ˆ", "ìˆ˜")
        
    Returns:
        str: "ìƒìƒ", "ìƒê·¹", "ë¹„í™”", "ë¹„ê·¹" ì¤‘ í•˜ë‚˜
    """
    if element1 not in WUXING_5 or element2 not in WUXING_5:
        return "unknown"
    
    if WUXING_RELATIONS["ìƒìƒ"].get(element1) == element2:
        return "ìƒìƒ"
    elif WUXING_RELATIONS["ìƒê·¹"].get(element1) == element2:
        return "ìƒê·¹"
    elif element1 == element2:
        return "ë¹„í™”"  # ê°™ì€ ì˜¤í–‰
    else:
        return "ë¹„ê·¹"  # íŠ¹ë³„í•œ ê´€ê³„ ì—†ìŒ

def validate_date(year: int, month: int, day: int) -> bool:
    """
    ë‚ ì§œ ìœ íš¨ì„± ê²€ì¦
    
    Args:
        year, month, day: ê²€ì¦í•  ë‚ ì§œ
        
    Returns:
        bool: ìœ íš¨í•œ ë‚ ì§œì¸ì§€ ì—¬ë¶€
    """
    try:
        date(year, month, day)
        return True
    except ValueError:
        return False

# ==========================================
# ğŸ“ ìƒìˆ˜ ë¬´ê²°ì„± ê²€ì¦
# ==========================================

def validate_constants() -> dict:
    """
    ìƒìˆ˜ë“¤ì˜ ë¬´ê²°ì„± ê²€ì¦
    
    Returns:
        dict: ê²€ì¦ ê²°ê³¼
    """
    results = {
        "gapja_60_count": len(GAPJA_60) == 60,
        "cheongan_10_count": len(CHEONGAN_10) == 10,
        "jiji_12_count": len(JIJI_12) == 12,
        "solar_terms_24_count": len(SOLAR_TERMS_24) == 24,
        "reference_gapja_valid": GAPJA_60[REFERENCE_GAPJA_INDEX] == "ê°‘ì§„",
        "all_valid": True
    }
    
    # ì „ì²´ ìœ íš¨ì„± í™•ì¸
    results["all_valid"] = all(results.values())
    
    return results


# ==========================================
# ğŸ“ ìƒìˆ˜ ê²€ì¦ ì‹¤í–‰ (ì„í¬íŠ¸ ì‹œ ìë™ ì‹¤í–‰)
# ==========================================

if __name__ == "__main__":
    print("ğŸŒŸ ì‚¬ì£¼ ì‹œìŠ¤í…œ ì „ì—­ ìƒìˆ˜ ê²€ì¦")
    print("=" * 40)
    
    validation = validate_constants()
    for key, value in validation.items():
        status = "âœ…" if value else "âŒ"
        print(f"{status} {key}: {value}")
    
    print(f"\nğŸ“ ê¸°ì¤€ ì •ë³´:")
    print(f"  ê¸°ì¤€ì¼: {REFERENCE_DATE}")
    print(f"  ê¸°ì¤€ê°‘ì: {GAPJA_60[REFERENCE_GAPJA_INDEX]} (ì¸ë±ìŠ¤ {REFERENCE_GAPJA_INDEX})")
    
    # ê°‘ì ì •ë³´ í…ŒìŠ¤íŠ¸
    print(f"\nğŸ”® ê°‘ì ì •ë³´ í…ŒìŠ¤íŠ¸:")
    test_gapja = "ê³„ë¯¸"
    info = get_gapja_info(test_gapja)
    print(f"  {test_gapja}: {info}")
else:
    # ì„í¬íŠ¸ ì‹œ ìë™ ê²€ì¦
    validation = validate_constants()
    if not validation["all_valid"]:
        raise ValueError("âŒ ì‚¬ì£¼ ìƒìˆ˜ ë¬´ê²°ì„± ê²€ì¦ ì‹¤íŒ¨! ìƒìˆ˜ íŒŒì¼ì„ í™•ì¸í•˜ì„¸ìš”.")