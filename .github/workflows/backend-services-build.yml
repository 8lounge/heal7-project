name: Backend Services Build and Test

on:
  push:
    branches: [ main ]
    paths:
      - 'heal7-project/backend/**'
      - '.github/workflows/backend-services-build.yml'
  pull_request:
    branches: [ main ]
    paths:
      - 'heal7-project/backend/**'
  workflow_dispatch:

env:
  PYTHON_VERSION: '3.12'

jobs:
  # 1. ì‚¬ì£¼ ì„œë¹„ìŠ¤ (í¬íŠ¸ 8012)
  build-saju-service:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        cache: 'pip'
    
    - name: Install saju service dependencies
      run: |
        cd heal7-project/backend/services/saju-service
        pip install -r requirements.txt
    
    - name: Test saju service
      run: |
        cd heal7-project/backend/services/saju-service
        python -c "import main; print('âœ… Saju service imports successfully')"
        
    - name: Upload saju service artifacts
      uses: actions/upload-artifact@v4
      with:
        name: saju-service-build
        path: heal7-project/backend/services/saju-service/
        retention-days: 30

  # 2. í¬ë¡¤ë§ ì„œë¹„ìŠ¤ (í¬íŠ¸ 8013)  
  build-crawling-service:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        cache: 'pip'
    
    - name: Install crawling service dependencies
      run: |
        cd heal7-project/backend/services/crawling-service
        pip install -r requirements.txt
        
    - name: Test crawling service
      run: |
        cd heal7-project/backend/services/crawling-service
        python -c "import main; print('âœ… Crawling service imports successfully')"
        
    - name: Upload crawling service artifacts
      uses: actions/upload-artifact@v4
      with:
        name: crawling-service-build
        path: heal7-project/backend/services/crawling-service/
        retention-days: 30

  # 3. ì„œë¥˜ ì²˜ë¦¬ ì„œë¹„ìŠ¤ (í¬íŠ¸ 8010)
  build-paperwork-service:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        cache: 'pip'
    
    - name: Install paperwork service dependencies
      run: |
        cd heal7-project/backend/services/paperwork-service
        pip install -r requirements.txt
        
    - name: Test paperwork service
      run: |
        cd heal7-project/backend/services/paperwork-service
        python -c "import main; print('âœ… Paperwork service imports successfully')"
        
    - name: Upload paperwork service artifacts
      uses: actions/upload-artifact@v4
      with:
        name: paperwork-service-build
        path: heal7-project/backend/services/paperwork-service/
        retention-days: 30

  # 4. AI ëª¨ë‹ˆí„°ë§ ì„œë¹„ìŠ¤ (í¬íŠ¸ 8014)
  build-ai-monitoring-service:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        cache: 'pip'
    
    - name: Install ai-monitoring service dependencies
      run: |
        cd heal7-project/backend/services/ai-monitoring-service
        pip install -r requirements.txt
        
    - name: Test ai-monitoring service
      run: |
        cd heal7-project/backend/services/ai-monitoring-service
        python -c "import main; print('âœ… AI monitoring service imports successfully')"
        
    - name: Upload ai-monitoring service artifacts
      uses: actions/upload-artifact@v4
      with:
        name: ai-monitoring-service-build
        path: heal7-project/backend/services/ai-monitoring-service/
        retention-days: 30

  # 5. ëŒ€ì‹œë³´ë“œ ì„œë¹„ìŠ¤ (í¬íŠ¸ 8015) - ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ í—ˆë¸Œ
  build-dashboard-service:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        cache: 'pip'
    
    - name: Install dashboard service dependencies
      run: |
        cd heal7-project/backend/services/dashboard-service
        pip install -r requirements.txt
        
    - name: Test dashboard service (orchestration hub)
      run: |
        cd heal7-project/backend/services/dashboard-service
        python -c "import main; print('âœ… Dashboard orchestration service imports successfully')"
        
    - name: Upload dashboard service artifacts
      uses: actions/upload-artifact@v4
      with:
        name: dashboard-service-build
        path: heal7-project/backend/services/dashboard-service/
        retention-days: 30

  # í†µí•© ë¹Œë“œ ì•Œë¦¼
  build-summary:
    needs: [build-saju-service, build-crawling-service, build-paperwork-service, build-ai-monitoring-service, build-dashboard-service]
    runs-on: ubuntu-latest
    if: always()
    steps:
    - name: Backend services build summary
      run: |
        echo "ğŸ¼ HEAL7 Backend Services Build Summary"
        echo "======================================"
        echo "âœ… Saju Service (í¬íŠ¸ 8012): ì‚¬ì£¼ëª…ë¦¬ ê³„ì‚° ë° í•´ì„"
        echo "âœ… Crawling Service (í¬íŠ¸ 8013): ë°ì´í„° ìˆ˜ì§‘ ë° í¬ë¡¤ë§"  
        echo "âœ… Paperwork Service (í¬íŠ¸ 8010): ì„œë¥˜ ì²˜ë¦¬ ë° AI ë¶„ì„"
        echo "âœ… AI Monitoring Service (í¬íŠ¸ 8014): AI ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§"
        echo "âœ… Dashboard Service (í¬íŠ¸ 8015): ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ í—ˆë¸Œ â­"
        echo ""
        echo "ğŸŒ ëª¨ë“  ì„œë¹„ìŠ¤ê°€ GitHub Actionsì—ì„œ ì„±ê³µì ìœ¼ë¡œ ë¹Œë“œë˜ì—ˆìŠµë‹ˆë‹¤!"
        echo "ğŸš€ ì„œë²„ ë¶€ë‹´ ì—†ì´ í´ë¼ìš°ë“œì—ì„œ ë¹Œë“œ ì™„ë£Œ"